<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Fixed Glass OS</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>

<style>
    :root {
        --font-main: 'Outfit', sans-serif;
        --app-size: 60px;
        --grid-cols: 4;
        --grid-rows: 5; /* 4x5 Grid */
        --gap: 15px;
        --glass-bg: rgba(255, 255, 255, 0.2);
        --folder-bg: rgba(255, 255, 255, 0.35);
        --accent: #007AFF;
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }

    body {
        margin: 0; height: 100vh;
        display: flex; justify-content: center; align-items: center;
        background: #1c1c1e;
        font-family: var(--font-main);
        overflow: hidden;
    }
/* Hide text labels in the dock */
.app-slot[data-type="dock"] .icon-label {
    display: none;
}

    /* --- Device Chassis --- */
    .phone-frame {
        width: 360px; height: 780px;
        background: #000;
        border-radius: 50px;
        position: relative;
        box-shadow: 0 0 0 2px #333, 0 40px 80px rgba(0,0,0,0.5);
        overflow: hidden;
    }

    .screen-container {
        width: 100%; height: 99%;
        background: url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=2670&auto=format&fit=crop') center/cover no-repeat;
        position: relative;
        border-radius: 46px;
        overflow: hidden;
        color: white;
    }

    /* --- Status Bar --- */
    .status-bar {
        position: absolute; top: 0; width: 100%; height: 40px;
        z-index: 100;
        display: flex; justify-content: space-between; padding: 12px 25px;
        font-size: 13px; font-weight: 600; text-shadow: 0 1px 3px rgba(0,0,0,0.5);
    }

    /* --- Home Pages Container --- */
    .pages-slider {
        display: flex;
        width: 100%; height: 100%;
        transition: transform 0.3s cubic-bezier(0.25, 1, 0.5, 1);
    }

    .page {
        min-width: 100%; height: 100%;
        padding-top: 60px;
        display: grid;
        grid-template-columns: repeat(var(--grid-cols), 1fr);
        grid-template-rows: repeat(var(--grid-rows), 90px);
        padding-left: 15px; padding-right: 15px;
    }

    /* --- App Icons --- */
    .app-slot {
        position: relative;
        display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
        transition: transform 0.2s;
    }

    .app-icon {
        width: var(--app-size); height: var(--app-size);
        border-radius: 14px;
        display: flex; align-items: center; justify-content: center;
        font-size: 26px; color: white;
        background-size: cover;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        position: relative;
    }

    .app-name {
        font-size: 11px; margin-top: 6px; text-shadow: 0 1px 3px rgba(0,0,0,0.8);
        text-align: center; width: 66px;
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    /* Folder Mini-Grid */
    .folder-grid {
        display: grid; grid-template-columns: 1fr 1fr; gap: 3px;
        padding: 9px; width: 100%; height: 100%;
    }
    .mini-icon {
        width: 100%; height: 100%; border-radius: 3px;
        background-color: rgba(255,255,255,0.8);
    }

    /* --- Dock --- */
    .dock {
        position: absolute; bottom: 35px; left: 15px; right: 15px;
        height: 90px;
        background: rgba(255,255,255,0.2);
        backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
        border-radius: 32px;
        display: flex; justify-content: space-around; align-items: center;
        z-index: 50;
        border: 1px solid rgba(255,255,255,0.1);
    }

    /* --- Dragging Ghost --- */
    .dragging-clone {
        position: fixed; pointer-events: none; z-index: 999;
        transform: scale(1.1); opacity: 0.9;
    }

    /* --- Overlays --- */
    .overlay-panel {
        position: absolute; left: 0; width: 100%;
        background: rgba(20, 20, 25, 0.85);
        backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
        z-index: 200;
        transition: transform 0.35s cubic-bezier(0.165, 0.84, 0.44, 1);
        display: flex; flex-direction: column;
    }

    .overlay-panel[id="notifShade"]{
        z-index: 250;
    }

    /* Notification Shade (Top) */
    #notifShade {
        top: 0; height: 100%;
        transform: translateY(-100%);
        padding: 50px 20px;
    }
    #notifShade.open { transform: translateY(0); }

    /* App Drawer (Bottom) */
    #appDrawer {
        top: 0; height: 100%;
        transform: translateY(100%);
        padding: 60px 20px 20px 20px;
        background: rgba(0, 0, 0, 0.6);
    }
    #appDrawer.open { transform: translateY(0); }

    .drawer-list {
        display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;
        overflow-y: auto; padding-bottom: 50px;
    }

    /* --- Notification UI --- */
    .control-row { display: flex; gap: 15px; margin-bottom: 25px; }
    .toggle-btn {
        width: 60px; height: 60px; border-radius: 16px; background: rgba(255,255,255,0.15);
        display: flex; align-items: center; justify-content: center; font-size: 22px; transition:0.2s;
    }
    .toggle-btn.active { background: var(--accent); color: white; }
    
    .notif-item {
        background: rgba(255,255,255,0.1); border-radius: 16px; padding: 15px;
        margin-bottom: 10px; display: flex; align-items: center; gap: 12px;
    }

    /* --- Folder Modal --- */
    .folder-modal {
        position: absolute; inset: 0; z-index: 300;
        background: rgba(0,0,0,0.5); backdrop-filter: blur(10px);
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        opacity: 0; pointer-events: none; transition: 0.3s;
    }
    .folder-modal.open { opacity: 1; pointer-events: all; }

    .folder-content {
        width: 300px; padding: 25px; background: rgba(255,255,255,0.2);
        border-radius: 35px;
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;
        min-height: 150px;
        border: 1px solid rgba(255,255,255,0.2);
    }

    /* Pagination Dots */
    .dots-container {
        position: absolute; bottom: 120px; width: 100%; display: flex; justify-content: center; gap: 8px;
    }
    .dot { width: 6px; height: 6px; background: rgba(255,255,255,0.4); border-radius: 50%; }
    .dot.active { background: white; transform: scale(1.3); }

</style>
</head>
<body>

<div class="phone-frame">
    <div class="screen-container" id="mainScreen">
        
        <div class="status-bar">
            <span id="clockTime">12:00</span>
            <span><i class="fas fa-wifi"></i>&nbsp; <i class="fas fa-battery-full"></i></span>
        </div>

        <div class="overlay-panel" id="notifShade">
            <h2 style="margin-top:0">Control Center</h2>
            <div class="control-row">
                <div class="toggle-btn active"><i class="fas fa-wifi"></i></div>
                <div class="toggle-btn active"><i class="fab fa-bluetooth-b"></i></div>
                <div class="toggle-btn"><i class="fas fa-plane"></i></div>
                <div class="toggle-btn"><i class="fas fa-moon"></i></div>
            </div>
            <h3>Notifications</h3>
            <div class="notif-item">
                <div style="width:40px;height:40px;background:#34C759;border-radius:10px;display:flex;justify-content:center;align-items:center"><i class="fas fa-comment"></i></div>
                <div>
                    <div style="font-weight:600;font-size:14px;">Messages</div>
                    <div style="font-size:12px;opacity:0.8;">Mom: Dinner at 6?</div>
                </div>
            </div>
            <div class="notif-item">
                <div style="width:40px;height:40px;background:#FF3B30;border-radius:10px;display:flex;justify-content:center;align-items:center"><i class="fab fa-youtube"></i></div>
                <div>
                    <div style="font-weight:600;font-size:14px;">YouTube</div>
                    <div style="font-size:12px;opacity:0.8;">New subscriber!</div>
                </div>
            </div>
            
            <div style="margin-top:auto; align-self:center; opacity:0.6; padding:20px;" onclick="closeShade()">
                <i class="fas fa-chevron-up"></i>
            </div>
        </div>

        <div class="pages-slider" id="pagesSlider">
            </div>

        <div class="dots-container" id="dotsContainer"></div>

        <div class="dock" id="dock">
            </div>

        <div class="overlay-panel" id="appDrawer">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h2 style="margin:0">App Library</h2>
                <i class="fas fa-times" style="font-size:24px; padding:10px" onclick="closeDrawer()"></i>
            </div>
            <div class="drawer-list" id="drawerList">
                </div>
        </div>

        <div class="folder-modal" id="folderModal">
            <div class="folder-content" id="folderInner"></div>
            <div style="margin-top:20px; font-size:13px; opacity:0.8; color:white;">Tap outside to close</div>
        </div>

    </div>
</div>

<script>
    /* =========================================
       1. DATA CONFIGURATION
       ========================================= */
    const appDB = {
        'mail': { name: 'Mail', icon: 'fa-envelope', color: '#007AFF' },
        'cal':  { name: 'Calendar', icon: 'fa-calendar-alt', color: '#FF3B30' },
        'photos': { name: 'Photos', icon: 'fa-images', color: 'linear-gradient(to bottom right, #ff9a9e, #fad0c4)' },
        'camera': { name: 'Camera', icon: 'fa-camera', color: '#333' },
        'maps': { name: 'Maps', icon: 'fa-map-marked-alt', color: '#34C759' },
        'weather': { name: 'Weather', icon: 'fa-cloud-sun', color: '#5AC8FA' },
        'clock': { name: 'Clock', icon: 'fa-clock', color: '#000' },
        'notes': { name: 'Notes', icon: 'fa-sticky-note', color: '#FFD60A' },
        'settings': { name: 'Settings', icon: 'fa-cog', color: '#8E8E93' },
        'store': { name: 'App Store', icon: 'fa-layer-group', color: '#007AFF' },
        'safari': { name: 'Safari', icon: 'fa-compass', color: '#007AFF' },
        'music': { name: 'Music', icon: 'fa-music', color: '#FF2D55' },
        'files': { name: 'Files', icon: 'fa-folder', color: '#007AFF' },
        'health': { name: 'Health', icon: 'fa-heart', color: '#FF2D55' },
        'wallet': { name: 'Wallet', icon: 'fa-wallet', color: '#000' }
    };

    // Default Layout
    const defaultPages = [
        ['mail', 'cal', 'photos', 'weather', null, null, null, null, 'clock', 'notes', 'maps', 'settings'], // Page 1
        ['files', 'health', 'wallet', 'store'] // Page 2
    ];
    const defaultDock = ['camera', 'safari', 'mail', 'music'];

    // State Load
    let savedState = JSON.parse(localStorage.getItem('glass_os_state'));
    let pages = savedState ? savedState.pages : JSON.parse(JSON.stringify(defaultPages));
    let dock = savedState ? savedState.dock : JSON.parse(JSON.stringify(defaultDock));
    let pressTimer = null;
    let isdraggable=true;
    
    let currentPage = 0;

    function saveState() {
        localStorage.setItem('glass_os_state', JSON.stringify({ pages, dock }));
    }

    /* =========================================
       2. RENDERING
       ========================================= */
    const slider = document.getElementById('pagesSlider');
    const dockEl = document.getElementById('dock');
    const drawerList = document.getElementById('drawerList');
    const dotsContainer = document.getElementById('dotsContainer');

    function render() {
        // 1. Pages
        slider.innerHTML = '';
        pages.forEach((page, pageIdx) => {
            const pageDiv = document.createElement('div');
            pageDiv.className = 'page';
            
            // Ensure 20 slots (4x5 grid)
            for (let i = 0; i < 20; i++) {
                const item = page[i];
                const slot = document.createElement('div');
                slot.className = 'app-slot';
                slot.dataset.p = pageIdx;
                slot.dataset.i = i;
                
                if (item) {
                    slot.appendChild(createIcon(item));
                    addDragEvents(slot);
                }
                
                pageDiv.appendChild(slot);
            }
            slider.appendChild(pageDiv);
        });

        // 2. Dock
        dockEl.innerHTML = '';
        dock.forEach((item, i) => {
            const slot = document.createElement('div');
            slot.className = 'app-slot';
            // Simple dock rendering, no drag for now to keep it stable
            const icon = createIcon(item, true);
            icon.onclick = () => openApp(item);
            slot.appendChild(icon);
            dockEl.appendChild(slot);
        });

        // 3. Dots
        dotsContainer.innerHTML = '';
        pages.forEach((_, i) => {
            const d = document.createElement('div');
            d.className = `dot ${i === currentPage ? 'active' : ''}`;
            dotsContainer.appendChild(d);
        });

        // 4. Slide Position
        slider.style.transform = `translateX(-${currentPage * 100}%)`;

        // 5. Drawer
        drawerList.innerHTML = '';
        Object.keys(appDB).forEach(key => {
            const slot = document.createElement('div');
            slot.className = 'app-slot';
            slot.appendChild(createIcon(key));
            slot.onclick = () => openApp(key);
            drawerList.appendChild(slot);
        });
    }

    function createIcon(itemData, isDock=false) {
        // itemData could be string (ID) or object (Folder)
        if (typeof itemData === 'object' && itemData.type === 'folder') {
            // Folder
            const icon = document.createElement('div');
            icon.className = 'app-icon';
            icon.style.background = 'var(--folder-bg)';
            icon.style.backdropFilter = 'blur(10px)';
            
            const grid = document.createElement('div');
            grid.className = 'folder-grid';
            
            itemData.apps.slice(0, 4).forEach(appId => {
                const mini = document.createElement('div');
                mini.className = 'mini-icon';
                const app = appDB[appId];
                mini.style.background = app.color;
                grid.appendChild(mini);
            });
            
            icon.appendChild(grid);
            
            const name = document.createElement('div');
            name.className = 'app-name';
            name.innerText = 'Folder';
            
            const wrapper = document.createDocumentFragment();
            wrapper.appendChild(icon);
            if(!isDock) wrapper.appendChild(name);
            
            // Interaction
            icon.onclick = (e) => {
                cancelDrag();
                e.stopPropagation();
                openFolder(itemData);
            };

            return wrapper;
        } else {
            // Regular App
            const id = itemData;
            const app = appDB[id];
            
            const icon = document.createElement('div');
            icon.className = 'app-icon';
            if(app.color.includes('gradient')) icon.style.background = app.color;
            else icon.style.backgroundColor = app.color;
            
            icon.innerHTML = `<i class="fas ${app.icon}"></i>`;
            
            const name = document.createElement('div');
            name.className = 'app-name';
            if(itemData.type !== 'dock') name.innerText = app.name;

            const wrapper = document.createDocumentFragment();
            wrapper.appendChild(icon);
            if(!isDock) wrapper.appendChild(name);

            // Click Event
            icon.onclick = (e) => {
                if(!isDragging) {
                    e.stopPropagation();
                    openApp(id);
                }
            };
            
            return wrapper;
        }
    }

    function openApp(id) {
        cancelDrag();
        if(typeof id === 'string') alert("Opening " + appDB[id].name);
        //setTimeout(() => { isdraggable=true; }, 5000);
    }

    /* =========================================
       3. DRAG & DROP LOGIC (Refined)
       ========================================= */
    let isDragging = false;
    let dragTimer = null;
    let dragGhost = null;
    let dragSrc = null; // { p, i }

    function addDragEvents(slot) {
        // Touch
        slot.addEventListener('touchstart', (e) => handleStart(e, slot), {passive:false});
        slot.addEventListener('touchmove', handleMove, {passive:false});
        slot.addEventListener('touchend', handleEnd);
        
        // Mouse
        slot.addEventListener('mousedown', (e) => handleStart(e, slot));
    }

    function handleStart(e, slot) {
        // Start Timer for Long Press
        if(!isdraggable) return;
        //e.preventDefault();
        dragTimer = setTimeout(() => {
            isDragging = true;
            dragSrc = { p: parseInt(slot.dataset.p), i: parseInt(slot.dataset.i) };
            
            // Visuals
            if(navigator.vibrate) navigator.vibrate(50);
            
            // Create Ghost
            const rect = slot.getBoundingClientRect();
            dragGhost = slot.cloneNode(true);
            dragGhost.className = 'dragging-clone';
            dragGhost.style.width = rect.width + 'px';
            dragGhost.style.height = rect.height + 'px';
            // Center Ghost on finger
            updateGhostPosition(e);
            
            document.body.appendChild(dragGhost);
            slot.style.opacity = '0'; // Hide original

            // Mouse move binding
            if(e.type === 'mousedown' && !e.touches) {
                window.addEventListener('mousemove', handleMove);
                window.addEventListener('mouseup', handleEnd);
            }

        }, 400); // 400ms hold
    }

    function handleMove(e) {
        if(!isDragging) {
            clearTimeout(dragTimer);
            return;
        }
        e.preventDefault();
        updateGhostPosition(e);
    }

function cancelDrag() {
    clearTimeout(dragTimer);
    dragTimer = null;
    isDragging = false;
}


let lastEdgeSwitchTime = 0; // prevent multiple rapid switches
const EDGE_MARGIN = 60;
const EDGE_COOLDOWN = 500; // ms

function updateGhostPosition(e) {
    const x = e.touches ? e.touches[0].clientX : e.clientX;
    const y = e.touches ? e.touches[0].clientY : e.clientY;

    if (dragGhost) {
        dragGhost.style.left = (x - dragGhost.offsetWidth / 2) + 'px';
        dragGhost.style.top = (y - dragGhost.offsetHeight / 2) + 'px';
    }

    // Edge detection with cooldown
    let inside=0
    const now = Date.now();
    if (now - lastEdgeSwitchTime > EDGE_COOLDOWN) {
        if (x < EDGE_MARGIN && currentPage > 0) {
            inside=1
            currentPage--;
            lastEdgeSwitchTime = now;
            // Slide the pages without rerendering all icons
            slider.style.transform = `translateX(-${currentPage * 100}%)`;
        } else if (x > window.innerWidth - EDGE_MARGIN && currentPage < pages.length - 1 && !inside) {
            inside=1
            currentPage++;
            lastEdgeSwitchTime = now;
            slider.style.transform = `translateX(-${currentPage * 100}%)`;
        }else{inside=0}
    }
}


    function handleEnd(e) {
        clearTimeout(dragTimer);
        if(!isDragging) return;
        
        isDragging = false;
        
        // Get drop target
        // We temporarily hide ghost to see what's underneath
        dragGhost.style.display = 'none';
        const x = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
        const y = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
        const elBelow = document.elementFromPoint(x, y);
        dragGhost.remove();
        dragGhost = null;

        // Restore original just in case we don't drop successfully
        document.querySelectorAll('.app-slot').forEach(s => s.style.opacity = '1');

        if(elBelow) {
            const targetSlot = elBelow.closest('.app-slot');
            if(targetSlot && targetSlot.dataset.p) {
                const targetP = parseInt(targetSlot.dataset.p);
                const targetI = parseInt(targetSlot.dataset.i);
                
                handleDrop(dragSrc.p, dragSrc.i, targetP, targetI);
            }
        }
        
        // Cleanup Mouse listeners
        window.removeEventListener('mousemove', handleMove);
        window.removeEventListener('mouseup', handleEnd);
    }

    function handleDrop(srcP, srcI, tgtP, tgtI) {
        // Prevent dropping on self
        if(srcP === tgtP && srcI === tgtI) return;

        const srcItem = pages[srcP][srcI];
        const tgtItem = pages[tgtP][tgtI];

        if(!tgtItem) {
            // Move to Empty Slot
            pages[tgtP][tgtI] = srcItem;
            pages[srcP][srcI] = null;
        } else {
            // Target is occupied
            if(typeof tgtItem === 'string' && typeof srcItem === 'string') {
                // App on App -> Create Folder
                const folder = { type: 'folder', apps: [tgtItem, srcItem] };
                pages[tgtP][tgtI] = folder;
                pages[srcP][srcI] = null;
            } else if (typeof tgtItem === 'object' && tgtItem.type === 'folder' && typeof srcItem === 'string') {
                // App on Folder -> Add to Folder
                tgtItem.apps.push(srcItem);
                pages[srcP][srcI] = null;
            }
        }

        saveState();
        render();
    }

    /* =========================================
       4. GESTURES & SYSTEM UI
       ========================================= */
    const screen = document.getElementById('mainScreen');
    const hammer = new Hammer(screen);
    hammer.get('swipe').set({ direction: Hammer.DIRECTION_ALL });

    const shade = document.getElementById('notifShade');
    const drawer = document.getElementById('appDrawer');

    // Swipe Left/Right (Pagination)
    hammer.on('swipeleft', () => {
        if(currentPage < pages.length - 1 && !isDragging) {
            currentPage++;
            render();
        }
    });
    hammer.on('swiperight', () => {
        if(currentPage > 0 && !isDragging) {
            currentPage--;
            render();
        }
    });

    // Swipe Up (Drawer) - Only from bottom 20%
    hammer.on('swipeup', (e) => {
        const startY = e.center.y - e.deltaY; // approx start Y
        if(startY > window.innerHeight * 0.8 && shade.classList.contains('open') === false) {
            if(startY > window.innerHeight * 0.98) {alert("opening app view menu")}
            else{
            drawer.classList.add('open');}
        } else if(shade.classList.contains('open')) {
            closeShade();
        }
    });

    // Swipe Down (Shade) - Only from top 20%
    hammer.on('swipedown', (e) => {
        const startY = e.center.y - e.deltaY;
        if(startY < window.innerHeight * 0.25) {
            shade.classList.add('open');
        } /*else if(drawer.classList.contains('open')) {
            closeDrawer();
        }*/
    });

    function closeShade() { shade.classList.remove('open'); }
    function closeDrawer() { drawer.classList.remove('open'); }

    /* =========================================
       5. FOLDER MODAL
       ========================================= */
    const folderModal = document.getElementById('folderModal');
    const folderInner = document.getElementById('folderInner');

    function openFolder(folderData) {
        folderInner.innerHTML = '';
        folderData.apps.forEach(appId => {
            const app = appDB[appId];
            const div = document.createElement('div');
            div.style.display = 'flex';
            div.style.flexDirection = 'column';
            div.style.alignItems = 'center';
            div.innerHTML = `
                <div style="width:50px;height:50px;background:${app.color};border-radius:12px;display:flex;justify-content:center;align-items:center;color:white;font-size:24px;">
                    <i class="fas ${app.icon}"></i>
                </div>
                <div style="margin-top:5px;font-size:11px;color:white;">${app.name}</div>
            `;
            div.onclick = (e) => {
                e.stopPropagation();
                openApp(appId);
                folderModal.classList.remove('open');
            };
            folderInner.appendChild(div);
        });
        folderModal.classList.add('open');
    }

    folderModal.onclick = (e) => {
        if(e.target === folderModal) folderModal.classList.remove('open');
    }

    // Time Clock
    setInterval(() => {
        const d = new Date();
        document.getElementById('clockTime').innerText = 
            d.getHours() + ':' + String(d.getMinutes()).padStart(2,'0');
    }, 1000);

    // Initial Render
    render();

</script>
</body>
</html>